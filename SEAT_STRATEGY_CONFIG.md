# é€‰åº§ç­–ç•¥é…ç½®è¯´æ˜

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¶é—´**: 2026-01-16

---

## ğŸ“‹ å¯ç”¨ç­–ç•¥

### ç­–ç•¥ 1: é»˜è®¤ç­–ç•¥ (`default`)

**è¯´æ˜**: é€‰æ‹©ç¬¬ä¸€ä¸ªåœºæ¬¡å’Œç¬¬ä¸€ä¸ªä»·ä½ï¼ˆä¸è®ºæ˜¯å¦æœ‰ä½™ç¥¨ï¼‰

**é…ç½®**:
```yaml
seat_selection:
  strategy: "default"
```

**ç‰¹ç‚¹**:
- âœ… æœ€å¿«é€Ÿ
- âœ… ä¸æ£€æŸ¥ä½™ç¥¨
- âš ï¸ å¯èƒ½é€‰æ‹©å”®ç½„çš„åº§ä½

**é€‚ç”¨åœºæ™¯**:
- æµ‹è¯•ç¯å¢ƒ
- ç¡®å®šæ‰€æœ‰åº§ä½éƒ½æœ‰ä½™ç¥¨

---

### ç­–ç•¥ 2: ä¼˜å…ˆæœ‰ç¥¨ (`available_first`) â­ æ¨è

**è¯´æ˜**: éå†æ‰€æœ‰åœºæ¬¡ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªæœ‰ä½™ç¥¨çš„åº§ä½

**é…ç½®**:
```yaml
seat_selection:
  strategy: "available_first"
```

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨è·³è¿‡å”®ç½„åœºæ¬¡
- âœ… è‡ªåŠ¨é€‰æ‹©æœ‰ç¥¨çš„ä»·ä½
- âœ… é™çº§å¤„ç†ï¼šå¦‚æœéƒ½å”®ç½„ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªåœºæ¬¡

**é€‚ç”¨åœºæ™¯**:
- ğŸ¯ **æŠ¢ç¥¨**ï¼ˆæœ€æ¨èï¼‰
- å¤šåœºæ¬¡ã€å¤šä»·ä½çš„æ¼”å‡º
- ä¸ç¡®å®šå“ªäº›åœºæ¬¡æœ‰ä½™ç¥¨

**å·¥ä½œæµç¨‹**:
```
1. éå†æ‰€æœ‰åœºæ¬¡
2. æ£€æŸ¥æ¯ä¸ªä»·ä½çš„ä½™ç¥¨æ•°
3. æ‰¾åˆ°ç¬¬ä¸€ä¸ª remainCount > 0 çš„
4. å¦‚æœéƒ½å”®ç½„ï¼Œé™çº§åˆ°é»˜è®¤ç­–ç•¥
```

---

### ç­–ç•¥ 3: ä»·æ ¼ä¼˜å…ˆ (`price_priority`)

**è¯´æ˜**: æŒ‰ä»·æ ¼æ’åºï¼Œé€‰æ‹©æœ€ä¾¿å®œæˆ–æœ€è´µçš„æœ‰ç¥¨åº§ä½

**é…ç½®**:
```yaml
seat_selection:
  strategy: "price_priority"
  prefer: "cheapest"  # æˆ– "expensive"
```

**é…ç½®é€‰é¡¹**:
| å€¼ | è¯´æ˜ |
|---|---|
| `cheapest` | æœ€ä¾¿å®œä¼˜å…ˆï¼ˆä»ä½åˆ°é«˜ï¼‰ |
| `expensive` | æœ€è´µä¼˜å…ˆï¼ˆä»é«˜åˆ°ä½ï¼‰ |

**ç‰¹ç‚¹**:
- âœ… å¯ä»¥æ§åˆ¶é¢„ç®—
- âœ… å¯ä»¥é€‰æ‹©æœ€ä½³åº§ä½
- âš ï¸ å¯èƒ½é€‰æ‹©è¾ƒä¸çƒ­é—¨çš„åœºæ¬¡

**é€‚ç”¨åœºæ™¯**:
- é¢„ç®—æœ‰é™ï¼ˆé€‰æœ€ä¾¿å®œï¼‰
- è¿½æ±‚æœ€ä½³ä½“éªŒï¼ˆé€‰æœ€è´µï¼‰

**å·¥ä½œæµç¨‹**:
```
1. æ”¶é›†æ‰€æœ‰åœºæ¬¡å’Œä»·ä½
2. æŒ‰ä»·æ ¼æ’åºï¼ˆå‡åºæˆ–é™åºï¼‰
3. é€‰æ‹©ç¬¬ä¸€ä¸ªæœ‰ä½™ç¥¨çš„
```

---

### ç­–ç•¥ 4: è‡ªå®šä¹‰ (`custom`)

**è¯´æ˜**: æ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰æ¡ä»¶é€‰æ‹©åº§ä½

**é…ç½®**:
```yaml
seat_selection:
  strategy: "custom"
  config:
    preferred_date: "20260212"      # ä¼˜å…ˆæ—¥æœŸ
    preferred_time: "7:00 PM"       # ä¼˜å…ˆæ—¶é—´
    preferred_grade: "Rì„"          # ä¼˜å…ˆåº§ä½ç­‰çº§
    max_price: 150000               # æœ€é«˜ä»·æ ¼
    min_remain: 1                   # æœ€å°‘ä½™ç¥¨æ•°
```

**é…ç½®é€‰é¡¹**:
| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `preferred_date` | String | ä¼˜å…ˆæ—¥æœŸ | "20260212" |
| `preferred_time` | String | ä¼˜å…ˆæ—¶é—´ | "7:00 PM" |
| `preferred_grade` | String | ä¼˜å…ˆåº§ä½ç­‰çº§ | "Rì„", "Sì„", "Aì„" |
| `max_price` | Integer | æœ€é«˜ä»·æ ¼ | 150000 |
| `min_remain` | Integer | æœ€å°‘ä½™ç¥¨æ•° | 1, 2, 3 |

**ç‰¹ç‚¹**:
- âœ… å®Œå…¨è‡ªå®šä¹‰
- âœ… ç²¾ç¡®æ§åˆ¶é€‰åº§æ¡ä»¶
- âš ï¸ å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ï¼Œè¿”å›ç©º

**é€‚ç”¨åœºæ™¯**:
- æœ‰æ˜ç¡®åå¥½çš„ç”¨æˆ·
- éœ€è¦ç²¾ç¡®æ§åˆ¶é€‰åº§æ¡ä»¶
- å¤šæ¡ä»¶ç­›é€‰

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config.yaml`:

```yaml
seat_selection:
  strategy: "available_first"  # é€‰æ‹©ç­–ç•¥
```

### æ–¹æ³• 2: åœ¨ä»£ç ä¸­ä½¿ç”¨

```python
from src.seat_strategy import SeatSelector

# åˆ›å»ºé€‰åº§å™¨
selector = SeatSelector(client, config, logger)

# ä½¿ç”¨ç­–ç•¥2ï¼šä¼˜å…ˆæœ‰ç¥¨
selected = selector.select(
    seats_info=seats_info,
    strategy='available_first'
)

# ä½¿ç”¨ç­–ç•¥3ï¼šä»·æ ¼ä¼˜å…ˆï¼ˆæœ€ä¾¿å®œï¼‰
selected = selector.select(
    seats_info=seats_info,
    strategy='price_priority',
    user_config={'prefer': 'cheapest'}
)

# ä½¿ç”¨ç­–ç•¥4ï¼šè‡ªå®šä¹‰
selected = selector.select(
    seats_info=seats_info,
    strategy='custom',
    user_config={
        'preferred_date': '20260212',
        'preferred_time': '7:00 PM',
        'preferred_grade': 'Rì„',
        'max_price': 150000,
        'min_remain': 1
    }
)
```

### æ–¹æ³• 3: è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# ç­–ç•¥2ï¼šä¼˜å…ˆæœ‰ç¥¨
PYTHONPATH=/Users/shihaotian/Desktop/edison/itp/src python3 src/test_strategy_available_first.py
```

---

## ğŸ“Š ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | é€Ÿåº¦ | æˆåŠŸç‡ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|------|--------|---------|--------|
| `default` | â­â­â­â­â­ | ä½ | æµ‹è¯• | â­â­ |
| `available_first` | â­â­â­â­ | é«˜ | æŠ¢ç¥¨ | â­â­â­â­â­ |
| `price_priority` | â­â­â­ | ä¸­ | é¢„ç®—æ§åˆ¶ | â­â­â­â­ |
| `custom` | â­â­â­ | é«˜ | ç²¾ç¡®æ§åˆ¶ | â­â­â­â­ |

---

## ğŸ¯ å®é™…æµ‹è¯•ç»“æœ

### å½“å‰æµ‹è¯•ï¼ˆ2026-01-16ï¼‰

```
æ‰€æœ‰åœºæ¬¡å’Œä½™ç¥¨æƒ…å†µ:
======================================================================
åœºæ¬¡ 001 - 7:00 PM
  Rì„: 143,000éŸ©å…ƒ - âŒ å”®ç½„
  Sì„: 132,000éŸ©å…ƒ - âŒ å”®ç½„
======================================================================

ä½¿ç”¨ã€ä¼˜å…ˆæœ‰ç¥¨ã€‘ç­–ç•¥æœç´¢...
âš ï¸ æ‰€æœ‰åœºæ¬¡éƒ½æ²¡æœ‰ä½™ç¥¨ï¼Œé™çº§åˆ°é»˜è®¤ç­–ç•¥ï¼ˆé€‰æ‹©ç¬¬ä¸€ä¸ªåœºæ¬¡å’Œä»·ä½ï¼‰

é€‰æ‹©ç»“æœ:
  åœºæ¬¡: 001 (7:00 PM)
  ä»·ä½: Rì„ (143,000éŸ©å…ƒ)
  ä½™ç¥¨: 0ï¼ˆå”®ç½„ï¼‰
  ç­–ç•¥: available_first_fallback
```

**è¯´æ˜**:
- ç”±äºæ‰€æœ‰åº§ä½éƒ½å·²å”®ç½„ï¼Œç­–ç•¥è‡ªåŠ¨é™çº§åˆ°é»˜è®¤æ¨¡å¼
- åœ¨å®é™…å”®ç¥¨æœŸé—´ï¼Œç­–ç•¥ä¼šè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªæœ‰ä½™ç¥¨çš„åº§ä½
- ä»˜æ¬¾é“¾æ¥å·²ç”Ÿæˆï¼Œç”¨æˆ·å¯ä»¥åœ¨ç½‘é¡µä¸ŠæŸ¥çœ‹æ˜¯å¦æœ‰ç¥¨é‡Šæ”¾

---

## ğŸ“ ä»£ç ç»“æ„

```
src/
â”œâ”€â”€ seat_strategy.py          # é€‰åº§ç­–ç•¥æ¨¡å—
â”‚   â”œâ”€â”€ SeatSelectionStrategy    # åŸºç±»
â”‚   â”œâ”€â”€ DefaultStrategy          # ç­–ç•¥1: é»˜è®¤
â”‚   â”œâ”€â”€ AvailableFirstStrategy   # ç­–ç•¥2: ä¼˜å…ˆæœ‰ç¥¨ â­
â”‚   â”œâ”€â”€ PricePriorityStrategy    # ç­–ç•¥3: ä»·æ ¼ä¼˜å…ˆ
â”‚   â”œâ”€â”€ CustomStrategy           # ç­–ç•¥4: è‡ªå®šä¹‰
â”‚   â””â”€â”€ SeatSelector            # é€‰åº§å™¨ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
â”‚
â””â”€â”€ test_strategy_available_first.py  # æµ‹è¯•è„šæœ¬
```

---

## ğŸ”§ æ‰©å±•ç­–ç•¥

å¦‚æœéœ€è¦æ·»åŠ æ–°ç­–ç•¥ï¼Œç»§æ‰¿ `SeatSelectionStrategy` åŸºç±»ï¼š

```python
class MyCustomStrategy(SeatSelectionStrategy):
    """è‡ªå®šä¹‰ç­–ç•¥"""

    def select_seat(self, seats_info, user_config=None):
        # å®ç°é€‰åº§é€»è¾‘
        for play in seats_info:
            for seat in play['seats']:
                if self._check_condition(seat):
                    return self._build_result(play, seat)

        return None

    def _check_condition(self, seat):
        # æ£€æŸ¥æ¡ä»¶
        pass

    def _build_result(self, play, seat):
        # æ„å»ºè¿”å›ç»“æœ
        return {
            'play_date': play.get('playDate'),
            'play_seq': play.get('playSeq'),
            'seat_grade_name': seat.get('seatGradeName'),
            # ... å…¶ä»–å­—æ®µ
            'strategy': 'my_custom'
        }
```

---

## ğŸ“ æœ€ä½³å®è·µ

### æŠ¢ç¥¨åœºæ™¯

**æ¨èç­–ç•¥**: `available_first`

```yaml
seat_selection:
  strategy: "available_first"
```

**ä¼˜åŠ¿**:
- å¿«é€Ÿæ‰¾åˆ°æœ‰ä½™ç¥¨çš„åº§ä½
- è‡ªåŠ¨è·³è¿‡å”®ç½„åœºæ¬¡
- æé«˜æŠ¢ç¥¨æˆåŠŸç‡

### é¢„ç®—æœ‰é™åœºæ™¯

**æ¨èç­–ç•¥**: `price_priority` (cheapest)

```yaml
seat_selection:
  strategy: "price_priority"
  prefer: "cheapest"
```

**ä¼˜åŠ¿**:
- è‡ªåŠ¨é€‰æ‹©æœ€ä¾¿å®œçš„åº§ä½
- æ§åˆ¶è´­ç¥¨æˆæœ¬

### è¿½æ±‚å“è´¨åœºæ™¯

**æ¨èç­–ç•¥**: `price_priority` (expensive)

```yaml
seat_selection:
  strategy: "price_priority"
  prefer: "expensive"
```

**ä¼˜åŠ¿**:
- è‡ªåŠ¨é€‰æ‹©æœ€è´µçš„åº§ä½
- è·å¾—æœ€ä½³è§‚æ¼”ä½“éªŒ

### æœ‰æ˜ç¡®åå¥½

**æ¨èç­–ç•¥**: `custom`

```yaml
seat_selection:
  strategy: "custom"
  config:
    preferred_date: "20260212"
    preferred_time: "7:00 PM"
    preferred_grade: "Rì„"
    min_remain: 2  # è‡³å°‘2å¼ è¿åº§
```

**ä¼˜åŠ¿**:
- å®Œå…¨è‡ªå®šä¹‰
- ç²¾ç¡®æ§åˆ¶

---

## ğŸ“– æ€»ç»“

**å·²å®ç°çš„é€‰åº§ç­–ç•¥**:

âœ… ç­–ç•¥1: é»˜è®¤ç­–ç•¥ (`default`)
âœ… ç­–ç•¥2: ä¼˜å…ˆæœ‰ç¥¨ (`available_first`) â­ **æ¨è**
âœ… ç­–ç•¥3: ä»·æ ¼ä¼˜å…ˆ (`price_priority`)
âœ… ç­–ç•¥4: è‡ªå®šä¹‰ (`custom`)

**é»˜è®¤ç­–ç•¥**: `available_first` (ä¼˜å…ˆæœ‰ç¥¨)

**æµ‹è¯•è„šæœ¬**:
```bash
PYTHONPATH=/Users/shihaotian/Desktop/edison/itp/src python3 src/test_strategy_available_first.py
```

**è¯¦ç»†æ–‡æ¡£**:
- é€‰åº§é€»è¾‘è¯´æ˜: `SEAT_SELECTION_LOGIC.md`
- ç­–ç•¥å®ç°ä»£ç : `src/seat_strategy.py`

---

**æœ€åæ›´æ–°**: 2026-01-16
**ç»´æŠ¤è€…**: ITP Bot Team
